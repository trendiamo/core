{% comment %}Create variable so delay can be re-set if form has message{% endcomment %}
{%- assign popup_delay = section.settings.delay -%}

<div class="generic-pop js-generic-pop{% unless section.settings.enable %} generic-pop--disabled{% endunless %}" data-generic-enabled="{{ section.settings.enable }}" data-generic-delay="{{ popup_delay }}000" data-generic-expiry="{{ section.settings.expiry }}">
    <a href="#" class="generic-pop__close js-generic-pop-close icon-fallback">
        <i class="icon icon--close" aria-hidden="true"></i>
        <span class="icon-fallback__text">{{ 'layout.drawers.close' | t }}</span>
    </a>

    <div class="generic-pop__wrapper">
        <div class="generic-pop__content">

            {% unless section.settings.image == blank %}
                <img alt="{{ section.settings.image.alt }}" src="{{ section.settings.image | img_url: '600x' }}" />
            {% endunless %}

            {% unless section.settings.title == blank %}
                <div class="section__title generic-pop__title">
                    <h4 class="section__title-text">{{ section.settings.title | escape }}</h4>
                </div>
            {% endunless %}

            {% unless section.settings.text == blank %}
                <div class="generic-pop__desc rte">{{ section.settings.text }}</div>
            {% endunless %}

            {% unless section.settings.link == blank %}
                <a href="{{ section.settings.link }}" class="c-btn c-btn--primary c-btn--arrow c-btn--full generic-pop__link">{{ section.settings.link_title | escape }}</a>
            {% endunless %}
        </div>
    </div>
</div>

{% schema %}
{
    "name": "Generic Popup",
    "class": "js-section__generic-pop",
    "settings": [
        {
            "type": "checkbox",
            "id": "enable",
            "label": "Enable",
            "default": false,
            "info": "The popup does not display on mobile devices. For more information [click here](https://safeasmilk.zendesk.com/hc/en-gb/articles/115003509309)."
        },
        {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
        },
        {
            "type": "text",
            "id": "title",
            "label": "Heading",
            "default": "Popup"
        },
        {
            "type": "richtext",
            "id": "text",
            "label": "Text",
            "default": "<p>Use this popup as a simple call to action with a link to a product or a page.</p>"
        },
        {
            "type": "text",
            "id": "link_title",
            "label": "Button label",
            "default": "More info"
        },
        {
            "type": "url",
            "id": "link",
            "label": "Button link"
        },
        {
            "type": "header",
            "content": "Display settings"
        },
        {
            "type": "range",
            "id": "delay",
            "label": "Popup delay",
            "unit": "sec",
            "min": 1,
            "max": 15,
            "step": 1,
            "default": 3
        },
        {
            "type": "range",
            "id": "expiry",
            "label": "Popup expiry",
            "info": "Number of days before popup re-appears",
            "unit": "day",
            "min": 0,
            "max": 30,
            "step": 1,
            "default": 7
        },
        {
            "type": "header",
            "content": "Newsletter"
        },
        {
            "type": "paragraph",
            "content": "Every sign up will create a 'Customer account' in this store. [Manage customers](/admin/customers?query=&accepts_marketing=1)"
        }
    ]
}
{% endschema %}
